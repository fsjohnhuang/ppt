define("common:widget/ui/durationStat/durationStat",function(require,exports,module){function DurationStat(){var i=$(document),t=$(window),e=this;i.on("visibilitychange",function(){"visible"==document.visibilityState?e.heartStart():"hidden"==document.visibilityState&&e.heartEnd()}),t.on("beforeunload",function(){e.heartEnd()}),t.on("blur",function(){e.heartEnd()}),t.on("focus",function(){e.heartStart()}),i.on("click",function(){e.liveTime=+new Date}),t.on("scroll",function(){e.liveTime=+new Date}),this.begin=3}function heartLog(i){var t=this;return this.liveTime&&(+new Date-this.liveTime)/1e3>1800?(clearTimeout(this.heartTimer),!1):void(t.heartTimer=setTimeout(function(){sendDurationLog.call(t,i),preWork.call(t,i),heartLog.call(t,t.interval)},1e3*i))}function sendDurationLog(i){sendlog({interval:i,page:config[this.pageId-1].page,sid:this.sid,word:this.word,cs:this.cs})}function preWork(i){this.array.push(i),this.index++,this.interval=this.array[this.index-2]+this.array[this.index-1]}var utils=require("common:widget/ui/utils/utils"),$=require("common:widget/ui/base/base"),hijackLog=window.hijackLog,config=[{begin:2,page:"index"},{begin:3,page:"result"},{begin:3,page:"detail"}];$.extend(DurationStat.prototype,{heartStart:function(i){i&&(this.pageId=i.pageId,this.sid=i.sid,this.begin=config[i.pageId-1].begin,this.word=i.word,this.cs=i.cs),this.start||(this.reset(),this.array.push(this.begin),heartLog.call(this,this.begin))},heartEnd:function(){if(!this.finish){this.start=0,this.finish=1,clearTimeout(this.heartTimer);var endTime=+new Date,interval=(endTime-this.startTime)/1e3-eval(this.array.join("+"))+this.begin;sendDurationLog.call(this,parseFloat(interval).toFixed(2))}},reset:function(){this.startTime=+new Date,this.array=[],this.index=1,this.heartTimer=null,this.interval=0,this.finish=0,this.start=1}});var sendlog=function(){var i="//imgstat.baidu.com/9.gif";return function(t){var e=new Image,n=$.extend({_dev:"pc",samplekey:encodeURIComponent(window.samplekey||"")},t);e.src=i+"?"+utils.jsonToQuery(n)+"&_="+(new Date).getTime()}}();module.exports=new DurationStat});